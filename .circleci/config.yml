version: 2.1

commands:
    create_env:
        description: "Setups up the .env file, using secure variables!"
        steps:
            - run: echo 'REST_URL="$REST_URL"' >> .env
            - run: echo 'REST_KEY="$REST_KEY"' >> .env
            - run: cat .env

jobs:
    test_beta:
        docker:
            - image: circleci/php:7.2.15

        environment:
            REST_URL: "https://ucrm.dev.mvqn.net/api/v1.0"

        steps:
            - checkout
            - run:
                name: "Setup composer"
                command: >
                    sudo composer self-update &&
                    sudo composer install
            - run:
                name: "Create '.env' File"
                command: >
                    echo 'export REST_URL="$REST_URL"' >> .env &&
                    echo 'export REST_KEY="$REST_KEY"' >> .env &&
                    cat .env
            - run:
                name: "Testing Environment Variables"
                command: echo $REST_URL
            #- run:
            #    name: "Tests"
            #    command: echo $REST_URL && sudo vendor/bin/phpunit --configuration phpunit.xml




workflows:
    version: 2

    build_and_test:
        jobs:
            - test_beta:
                  context: ucrm.dev.mvqn.net